// const variables connected to DOM
const submitBtn = document.getElementById("submit-btn");
const passwordInput = document.getElementById("password");
const initialsInput = document.getElementById("initials");
const employeeIdInput = document.getElementById("employee-id");

// autogenerate password for employee company password
function generatePassword(length) {
    const charset = "abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789!@#$%^&*()_+-=[]{}|;':\"<>,.?/\\";
    let password = "";
    for (let i = 0; i < length; i++) {
        password += charset.charAt(Math.floor(Math.random() * charset.length));
    }
    return password;
}

// autogenerate employee Id number that is 6 numbers in length
function generateEmployeeId(){
    numbers = '';
    for(let i = 0; i < 6; i++){
        number = Math.floor(Math.random() * 10);
        number.toString();
        numbers += number
    }
    //console.log("numbers:" + numbers)
    return numbers;

}

let employeeId = generateEmployeeId();

// autongenerate company email based on newhire initials and the newly autogenerated employee id
function generateEmail(initials){
    let autoEmail = initials.toLowerCase() + employeeId + "@trakd.com";
    //console.log("autoEmail:" + autoEmail)
    return autoEmail;
}


function saveNewHire(){
    passwordInput.value = generatePassword(8);
    employeeIdInput.value = employeeId;


    // set variables equal to input fields values
    let finalPassword = passwordInput.value
    let finalEmployeeId = employeeIdInput.value
    let finalEmail = generateEmail(initialsInput.value);

    // create object of variables to send in post requests
    let data = {
        "employeeId": finalEmployeeId,
        "companyEmail": finalEmail,
        "password": finalPassword
    }
    // set url for post request
    let url = "http://localhost:8080/generate-credentials"

    // post request
    fetch(url, {
        method:"POST",
        headers:{
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(data),
    })
        .then(response => {
            if (response.ok){
                console.log("success!")
            } else {
                throw new Error("did not create newhire")
            }
        })
        .catch(error => {
            console.log(error)
        });
}

// when clicked button will hit api post route and render a new page
submitBtn.addEventListener("click" , (e) => {
    e.preventDefault();
    saveNewHire();
    window.location.replace("http://localhost:8080/create-newhire");
})